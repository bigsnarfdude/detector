2026-01-14 16:14:58,367 - INFO - ======================================================================
2026-01-14 16:14:58,367 - INFO - GPT-OSS 20B EXPERIMENT v2 (HARMONY FORMAT FIX)
2026-01-14 16:14:58,367 - INFO - ======================================================================
2026-01-14 16:14:58,367 - INFO - Model: unsloth/gpt-oss-20b-BF16
2026-01-14 16:14:58,367 - INFO - SAE: Goodfire/Hackathon-gpt-oss-20b-SAE-l15 (layer 15)
2026-01-14 16:14:58,367 - INFO - Reasoning Effort: high
2026-01-14 16:14:58,367 - INFO - Output Directory: results/gpt-oss-20b_v2_20260114_161458
2026-01-14 16:14:58,367 - INFO - 
2026-01-14 16:14:58,367 - INFO - CRITICAL FIX: Using Harmony chat template format
2026-01-14 16:14:58,367 - INFO - Previous experiment used raw tokenization (INCORRECT)
2026-01-14 16:14:58,367 - INFO - Loading training data...
2026-01-14 16:14:58,527 - INFO -   Training: 500 AF, 500 aligned
2026-01-14 16:14:58,528 - INFO - Loading gold_106 test set...
2026-01-14 16:14:58,646 - INFO -   Test: 51 AF, 55 aligned
2026-01-14 16:14:58,648 - INFO - ======================================================================
2026-01-14 16:14:58,648 - INFO - PHASE 1: EXTRACT ACTIVATIONS (Harmony Format)
2026-01-14 16:14:58,648 - INFO - ======================================================================
2026-01-14 16:14:58,648 - INFO - Model: unsloth/gpt-oss-20b-BF16
2026-01-14 16:14:58,648 - INFO - Layer: 15
2026-01-14 16:14:58,648 - INFO - Reasoning Effort: high
2026-01-14 16:14:58,648 - INFO - Samples: 1106
2026-01-14 16:14:59,521 - INFO -   Available VRAM: 16.7 GB
2026-01-14 16:14:59,521 - INFO - Loading tokenizer from unsloth/gpt-oss-20b-BF16...
2026-01-14 16:15:02,337 - INFO - Loading model unsloth/gpt-oss-20b-BF16 with CPU offload...
2026-01-14 16:15:02,337 - INFO -   Max memory allocation: {0: '11GB', 'cpu': '48GB'}
2026-01-14 16:18:50,528 - INFO -   Model loaded on cuda:0
2026-01-14 16:18:50,529 - INFO -   Has chat template: True
2026-01-14 16:18:50,529 - INFO -   Chat template preview: {# Copyright 2025-present Unsloth. Apache 2.0 License. Unsloth chat template fixes. Edited from ggml-org & OpenAI #}
{#-
  In addition to the normal inputs of `messages` and `tools`, this template als...
2026-01-14 16:18:50,529 - INFO - Extracting layer 15 activations with Harmony format...
2026-01-14 16:18:54,904 - INFO -     0/1106 samples processed...
2026-01-14 16:21:33,764 - INFO -     50/1106 samples processed...
2026-01-14 16:24:11,888 - INFO -     100/1106 samples processed...
2026-01-14 16:26:49,817 - INFO -     150/1106 samples processed...
2026-01-14 16:29:28,792 - INFO -     200/1106 samples processed...
2026-01-14 16:32:07,249 - INFO -     250/1106 samples processed...
2026-01-14 16:34:45,823 - INFO -     300/1106 samples processed...
2026-01-14 16:37:23,913 - INFO -     350/1106 samples processed...
2026-01-14 16:40:03,504 - INFO -     400/1106 samples processed...
2026-01-14 16:42:41,176 - INFO -     450/1106 samples processed...
2026-01-14 16:45:19,943 - INFO -     500/1106 samples processed...
2026-01-14 16:48:00,343 - INFO -     550/1106 samples processed...
2026-01-14 16:50:40,736 - INFO -     600/1106 samples processed...
2026-01-14 16:53:19,901 - INFO -     650/1106 samples processed...
2026-01-14 16:55:59,856 - INFO -     700/1106 samples processed...
2026-01-14 16:58:40,448 - INFO -     750/1106 samples processed...
2026-01-14 17:01:19,997 - INFO -     800/1106 samples processed...
2026-01-14 17:04:00,013 - INFO -     850/1106 samples processed...
2026-01-14 17:06:39,749 - INFO -     900/1106 samples processed...
2026-01-14 17:09:19,427 - INFO -     950/1106 samples processed...
2026-01-14 17:12:00,236 - INFO -     1000/1106 samples processed...
2026-01-14 17:14:45,078 - INFO -     1050/1106 samples processed...
2026-01-14 17:17:30,481 - INFO -     1100/1106 samples processed...
2026-01-14 17:17:47,020 - INFO -   Activations shape: torch.Size([1106, 2880])
2026-01-14 17:17:47,023 - INFO - Token logging complete: 1106 samples, 447586 total tokens, 404.7 avg tokens/sample
2026-01-14 17:17:47,023 - INFO -   Format artifacts saved for review
2026-01-14 17:17:47,023 - INFO - Saving activations and unloading model...
2026-01-14 17:17:47,030 - INFO -   Saved to results/gpt-oss-20b_v2_20260114_161458/activations_l15.pt
2026-01-14 17:17:47,603 - INFO -   Model unloaded, GPU memory freed
2026-01-14 17:17:47,605 - INFO - ======================================================================
2026-01-14 17:17:47,607 - INFO - PHASE 2: PROCESS WITH SAE
2026-01-14 17:17:47,608 - INFO - ======================================================================
2026-01-14 17:17:47,609 - INFO - Loading Goodfire SAE...
2026-01-14 17:17:58,196 - INFO -   Loaded: /home/vincent/.cache/huggingface/hub/models--Goodfire--Hackathon-gpt-oss-20b-SAE-l15/snapshots/d915f89ae449d5d5c90725ed6cbad520ebec343f/topk_sae_l15_exp16_k32.pt
2026-01-14 17:17:58,196 - INFO -   Keys: ['decoder_bias', 'encoder_linear.weight', 'decoder.weight']
2026-01-14 17:17:58,264 - INFO -   d_model: 2880, d_sae: 46080, k: 32
2026-01-14 17:17:58,264 - INFO - Encoding activations...
2026-01-14 17:17:58,268 - INFO -     32/1106...
2026-01-14 17:17:58,294 - INFO -     352/1106...
2026-01-14 17:17:58,321 - INFO -     672/1106...
2026-01-14 17:17:58,349 - INFO -     992/1106...
2026-01-14 17:17:58,369 - INFO -   Features shape: (1106, 46080)
2026-01-14 17:17:58,401 - INFO -   Sparsity: 99.9%
2026-01-14 17:17:58,711 - INFO -   SAE unloaded
2026-01-14 17:17:58,817 - INFO - ======================================================================
2026-01-14 17:17:58,817 - INFO - PHASE 3: TRAIN AND EVALUATE PROBE
2026-01-14 17:17:58,817 - INFO - ======================================================================
2026-01-14 17:17:59,265 - INFO - Cross-validation on training set...
2026-01-14 17:18:09,399 - INFO -   CV AUROC: 0.9921 (+/- 0.0043)
2026-01-14 17:18:09,400 - INFO - Training final probe...
2026-01-14 17:18:11,576 - INFO - Evaluating on gold_106 (held-out)...
2026-01-14 17:18:11,598 - INFO -   Test AUROC: 0.7832
2026-01-14 17:18:11,612 - INFO - 
  Classification Report:
2026-01-14 17:18:11,625 - INFO -               precision    recall  f1-score   support

     Aligned       0.70      0.84      0.76        55
          AF       0.78      0.61      0.68        51

    accuracy                           0.73       106
   macro avg       0.74      0.72      0.72       106
weighted avg       0.73      0.73      0.72       106

2026-01-14 17:18:11,627 - INFO - 
2026-01-14 17:18:11,627 - INFO - ======================================================================
2026-01-14 17:18:11,627 - INFO - SUMMARY
2026-01-14 17:18:11,627 - INFO - ======================================================================
2026-01-14 17:18:11,627 - INFO - CV AUROC:   0.9921 (+/- 0.0043)
2026-01-14 17:18:11,627 - INFO - Test AUROC: 0.7832
2026-01-14 17:18:11,627 - INFO - 
2026-01-14 17:18:11,627 - INFO - COMPARISON WITH v1 (no Harmony format):
2026-01-14 17:18:11,627 - INFO -   v1 Test AUROC: 0.7426
2026-01-14 17:18:11,627 - INFO -   v2 Test AUROC: 0.7832
2026-01-14 17:18:11,627 - INFO -   Improvement:   +0.0406
2026-01-14 17:18:11,627 - INFO - 
2026-01-14 17:18:11,627 - INFO - Results saved to results/gpt-oss-20b_v2_20260114_161458/
2026-01-14 17:18:11,627 - INFO - 
2026-01-14 17:18:11,627 - INFO - Artifacts for review:
2026-01-14 17:18:11,627 - INFO -   - experiment.log: Full experiment log
2026-01-14 17:18:11,627 - INFO -   - token_logs/: Token-level audit trail
2026-01-14 17:18:11,628 - INFO -   - format_artifacts.json: Harmony formatting examples
2026-01-14 17:18:11,628 - INFO -   - predictions.json: Per-sample predictions
2026-01-14 17:18:11,628 - INFO -   - feature_stats.json: SAE feature statistics
2026-01-14 17:18:11,628 - INFO - 
2026-01-14 17:18:11,628 - INFO - --------------------------------------------------
2026-01-14 17:18:11,628 - INFO - CROSS-MODEL COMPARISON
2026-01-14 17:18:11,628 - INFO - --------------------------------------------------
2026-01-14 17:18:11,628 - INFO - Model                     Test AUROC   Notes
2026-01-14 17:18:11,628 - INFO - --------------------------------------------------
2026-01-14 17:18:11,628 - INFO - Llama-3-8B                79.64%       Best interpretable
2026-01-14 17:18:11,628 - INFO - GPT-OSS 20B v2            78.32%       Harmony fix
2026-01-14 17:18:11,628 - INFO - GPT-OSS 20B v1            74.26%       NO Harmony (broken)
2026-01-14 17:18:11,628 - INFO - Gemma-3-27B               76.26%       Needs chat template fix
